ghostlaugh = {}local GHOST_CREATE = 1local GHOST_REMOVE = 2local GHOST_UPDATE = 3local GHOST_CHAT = 4local function Packet(typ)		local obj = 	{		stack = {},				Add = function(self, str)			if tonumber(str) then				str = math.Round(tonumber(str), 3)			end			table.insert(self.stack, str)		end,		Pack = function(self)			return table.concat(self.stack, "\31")		end,	}		obj:Add(typ)		return objendfunction ghostlaugh.CreatePlayer(ip, port, id, nick)		local p = Packet(GHOST_CREATE)		p:Add(id)	p:Add(nick)		intermsg.Send(ip, port, p:Pack())endfunction ghostlaugh.RemovePlayer(ip, port, id)	local p = Packet(GHOST_UPDATE)		p:Add(id)		intermsg.Send(ip, port, p:Pack())endfunction ghostlaugh.UpdatePosAng(ip, port, id, x,y,z, _p,_y,r)		local p = Packet(GHOST_UPDATE)		p:Add(id)			p:Add(x)	p:Add(y)	p:Add(z)		p:Add(_p)	p:Add(_y)	p:Add(r)		intermsg.Send(ip, port, p:Pack(), true)endfunction ghostlaugh.PlayerChat(ip, port, id, str)		local p = Packet(GHOST_CHAT)		p:Add(id)	p:Add(str)		intermsg.Send(ip, port, p:Pack())endfunction ghostlaugh.ParseIncomming(str)	local tbl = str:explode("\31")	local typ = tonumber(tbl[1])	local id = tbl[2]		table.remove(tbl, 1)	table.remove(tbl, 1)			if not typ then			elseif typ == GHOST_CREATE then				ghostlaugh.HandleCreatePlayer(id, unpack(tbl))	elseif typ == GHOST_REMOVE then		ghostlaugh.HandleRemovePlayer(id, unpack(tbl))	elseif typ == GHOST_UPDATE then		ghostlaugh.HandleUpdatePlayer(id, unpack(tbl))	elseif typ == GHOST_CHAT then		ghostlaugh.HandlePlayerChat(id, unpack(tbl))	endendevent.AddListener("IntermsgReceiveMessage", "ghostlaugh", function(ip, port, str)	ghostlaugh.ParseIncomming(str)end)for k,v in pairs(entities.GetAll()) do	if v.IsGhostlaugh then		v:Remove()	endendghostlaugh.entities = {}function ghostlaugh.HandleCreatePlayer(id, nick)		entities.SafeRemove(ghostlaugh.entities[id])		local ent = Entity("BasicEntity")		ent:BindToNetwork()		ent:Spawn()		ent:Physicalize(e.PE_RIGID)		ent.IsGhostlaugh = true		ent.ghostlaugh_nick = nick	ghostlaugh.entities[id] = ent		print("player created with id " .. id .. " and nick " .. nick, ent)endfunction ghostlaugh.HandleRemovePlayer(id)	entities.SafeRemove(ghostlaugh.entities[id])		print("player created with id " .. id)endfunction ghostlaugh.HandlePlayerChat(id, str)	local ent = ghostlaugh.entities[id] or NULL	if ent:IsValid() then		--[===[all:SendLua(([[			chat.AddText(unpack(chat.AddTimeStamp({Color(255, 128, 64), %q, color_white, ": ", %q})))		]]):format(ent.ghostlaugh_nick, str))]===]	end	print("player with id " .. id .. " said: " .. str)endfunction ghostlaugh.HandleUpdatePlayer(id, x,y,z, p,_y,r)		local ent = ghostlaugh.entities[id] or NULL		if ent:IsValid() then		local pos, ang = Vec3(tonumber(x),tonumber(y),tonumber(z)), Ang3(tonumber(p),tonumber(_y),tonumber(r))					ent:SetPos(pos)		ent:SetAngles(ang)				if id == "STEAM_0:1:9355639" then			local _, ply = next(entities.GetAllPlayers())			ply:SetPos(pos)			ply:SetEyeAngles(ang)			print(pos,ang)		end					--	print("player with id " .. id .. " updated pos = " .. tostring(pos) .. " ang = " .. tostring(ang))	end	endlocal ip, port = "192.168.0.10", 1111 for key, ply in pairs(entities.GetAllPlayers()) do	ply.ghostlaugh_init = nilendevent.AddListener("EntityRemoved", "ghostlaugh", function(ply)	if type(ply) == "player" then		ghostlaugh.RemovePlayer(ip,port, ply:GetName())	endend)event.AddListener("PostGameUpdate", "ghostlaugh", function()	for key, ply in pairs(entities.GetAllPlayers()) do		if not ply.ghostlaugh_init then			ghostlaugh.CreatePlayer(ip,port, ply:GetName(), ply:GetNicknamename())			ply.ghostlaugh_init = true		end			local pos = ply:GetPos()		pos = pos - Vec3(1009.8153686523, 1035.7658691406, 18.303159713745)		pos = pos * 39.3701				local ang = ply:GetEyeAngles()		ang = ang:Deg()						ghostlaugh.UpdatePosAng(ip,port, ply:GetName(), pos.x,pos.y,pos.z,  -ang.p,ang.r+90,ang.y)			endend)event.AddListener("PlayerSay", "ghostlaugh", function(ply, str)	ghostlaugh.PlayerChat(ip,port, ply:GetName(), str)end)intermsg.Host("192.168.0.10", 2222)intermsg.Host("192.168.0.10", 2222, true)